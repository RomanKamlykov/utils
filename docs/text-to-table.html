<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Table</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>

<nav class="navbar bg-body-tertiary">
    <div class="container">
        <a class="navbar-brand" href="/utils">Utils</a>
    </div>
</nav>

<div class="container">
    <div id="app">
        <h3>Text to Table</h3>

        <div class="mb-3">
            <a href="https://ozh.github.io/ascii-tables" target="_blank" rel="noopener noreferrer">source</a>
        </div>

        <div>
            <div class="mb-3">
                <label for="inputText" class="form-label">Text</label>
                <textarea id="inputText" class="form-control" :rows="rows" v-model="text"></textarea>
            </div>
            <div class="mb-3">
                <label for="inputDelimeter" class="form-label">Delimeter</label>
                <select id="inputDelimeter" class="form-select" v-model="delimeter">
                    <option v-for="el in delimeters" :value="el.value">{{ el.label }}</li>
                </select>
            </div>
            <div class="mb-3" v-if="delimeter === '\n'">
                <label for="inputColumns" class="form-label">Columns</label>
                <input type="text" id="inputColumns" class="form-control" v-model="columns">
            </div>
            <div class="mb-3">
                <label for="inputStyle" class="form-label">Style</label>
                <select id="inputStyle" class="form-select" v-model="style">
                    <option v-for="el in styles" :value="el.value">{{ el.label }}</li>
                </select>
            </div>
            <div class="form-check" v-if="style === '|'">
                <input type="checkbox" id="inputHeader" class="form-check-input" v-model="header">
                <label for="inputHeader" class="form-check-label">Header</label>
            </div>
        </div>
        <pre>{{ result }}</pre>
    </div>
</div>

<script>
const {computed, createApp, ref} = Vue;

function chunk(array, size = 1) {
    const result = [];
    for (let i = 0; i < array.length; i += size) {
        result.push(array.slice(i, i + size));
    }
    return result;
}

createApp({
	setup() {
        const rawText = ref('');
        const text = computed({
            get() {
                return rawText.value
            },
            set(val) {
                rawText.value = val.replace(/[\r\n]+/g, '\n');
            },
        });
        const rows = computed(() => {
            return Math.min(Math.max(text.value.split('\n').length, 5), 20);
        });
        const delimeters = [
            {label: 'tab', value: '\t'},
            {label: 'comma', value: ','},
            {label: 'newline', value: '\n'},
        ];
        const delimeter = ref(delimeters[0].value);
        const columns = ref('2');
        const styles = [
            {label: 'ASCII', value: '|'},
            {label: 'Markdown', value: 'm'},
            {label: 'TSV', value: '\t'},
            {label: 'CSV', value: ','},
        ];
        const style = ref(styles[0].value);
        const header = ref(true);
        const result = computed(() => {
            let result = '';
            if (!text.value) {
                return result;
            }

            const lines = text.value.split('\n');
            const rows = delimeter.value === '\n'
                ? chunk(lines.filter(line => line.trim()), +columns.value)
                : lines.map(line => line.split(delimeter.value));

            // TSV & CSV
            if (style.value === '\t' || style.value === ',') {
                return rows.map(row => {
                    return row.map(cell => {
                        return style.value == ',' && cell.includes(',') ? `"${cell}"` : cell;
                    }).join(style.value);
                }).join('\n');
            }

            // ASCII & Markdown
            const cols = rows[0].length;
            const width = [];
            rows.forEach(row => {
                row.forEach((cell, i) => {
                    width[i] = Math.max(cell.length, width[i] || 1, );
                });
            });

            const border = style.value === '|'
                // ASCII
                ? width.map(w => '+'.padEnd(w + 3, '-')).join('') + '+'
                // Markdown
                : width.map(w => '|'.padEnd(w + 3, '-')).join('') + '|';

            // ASCII border top
            if (style.value === '|') {
                result += border + '\n';
            }
            rows.forEach((row, i) => {
                row.forEach((cell, i) => {
                    result += `| ${cell.padEnd(width[i])} `;
                });
                result += '|\n';
                if (header.value && i === 0) {
                    result += border + '\n';
                }
            });
            // ASCII border bottom
            if (style.value === '|') {
                result += border;
            }

            return result;
        });
        return {text, rows, delimeters, delimeter, styles, style, columns, header, result};
	}
}).mount('#app')
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
